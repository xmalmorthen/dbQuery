const $dashMain={vars:{forms:{},tables:{results:[]},stopSearch:!1,cmbBdPropagationCount:0,cmbCamposSelectedValues:null,screenHeightInit:0},fncs:{init:async()=>{$.fn.select2.defaults.set("language","es"),$(".select2Cmb").select2({width:"100%",templateSelection:$dashMain.utils.Select2TemplateSelection,escapeMarkup:function(e){return e}}),$(".select2Cmb.dataFont").select2({width:"100%",templateSelection:$dashMain.utils.Select2TemplateSelection,escapeMarkup:function(e){return e},matcher:(e,a)=>{if(""===$.trim(e.term)||void 0===a.children)return a;if(0==a.text.toUpperCase().indexOf(e.term.toUpperCase()))return a;var t=[];if($.each(a.children,function(a,n){0==n.text.toUpperCase().indexOf(e.term.toUpperCase())&&t.push(n)}),t.length){var n=$.extend({},a,!0);return n.children=t,n}return null}}),$("#searchView").addClass("show"),$("#entidad, #bd, #campo").on("select2:selecting",$dashMain.actions.change.handleAll),$("#bd").on("select2:select",e=>{$dashMain.vars.cmbBdPropagationCount++,$dashMain.actions.change.cmbBdChange(e)}),$("#bd").on("select2:unselect",e=>{$dashMain.vars.cmbBdPropagationCount++,$dashMain.actions.change.cmbBdChange(e)}),$("#campo").on("select2:selecting",$dashMain.actions.change.cmbCampoChangeSelect),$("#campo").on("select2:unselecting",$dashMain.actions.change.cmbCampoChangeUnSelect),$("#frmConfigSearch").on("submit",$dashMain.actions.fill.search),$(".clearSearch").on("click",$dashMain.actions.click.clearSearch),$(".cancelSearch").on("click",$dashMain.actions.click.cancelSearch),$("#accordionSearchResult").on("shown.bs.collapse",function(){$__searchModel=$dashMain.vars.tables.results.find(e=>e.id==$(this).find(".collapsed.collapse.show").attr("aria-labelledby")),$__searchModel&&($__searchModel.tblObj.responsive.recalc(),$__searchModel.tblObj.responsive.rebuild())}),$dashMain.actions.populate.entidades(),$dashMain.actions.populate.bd(),$dashMain.actions.populate.findFor(["9999"],!1),$dashMain.vars.screenHeightInit=window.screen.height,$.fn.dataTable.ext.errMode="none",$dashMain.utils.ajaxSetup(),window.addEventListener("beforeunload",function(){$.xhrPool.abortAll()})}},actions:{populate:{entidades:()=>{const e=$("#entidad");$dashMain.utils.genericCMB({item:e,pairNames:{key:"cveEntidad",value:"descripcion"},notifyDom:$("#searchViewForm"),genericAjaxPromiseOptions:{ajax:{type:"POST",url:`${siteUrl}Catalogs/ajaxEntidades`,data:{csrf_QUERY:csrf.hash},headers:{}},loadingOverlayObj:e.parent().find(".select2 .select2-selection").length>0?e.parent().find(".select2 .select2-selection"):e}}).then(a=>{if(!a)return a;e.append(new Option("TODAS","9999",!0,!0)),e.select2("focus")})},bd:()=>{const e=$("#bd");$dashMain.utils.genericCMB({item:e,pairNames:{key:"id",value:"descripcion"},notifyDom:$("#searchViewForm"),genericAjaxPromiseOptions:{ajax:{type:"POST",url:`${siteUrl}Catalogs/ajaxDBWithConfig`,data:{csrf_QUERY:csrf.hash},headers:{}},loadingOverlayObj:e.parent().find(".select2 .select2-selection").length>0?e.parent().find(".select2 .select2-selection"):e}}).then(a=>{if(!a)return a;e.append(new Option("TODOS","9999",!0,!0))})},findFor:async(e,a)=>{const t=$("#searchViewForm"),n=$("#frmConfigSearch .sectionInsertInputs"),s=$("#campo"),o=e||$("#bd").val(),i=s.parent().find(".select2 .select2-selection").length>0?s.parent().find(".select2 .select2-selection"):s;null==$dashMain.vars.cmbCamposSelectedValues&&($dashMain.vars.cmbCamposSelectedValues=[...new Set(s.find("option").map((e,a)=>{if(s.val().includes($(a).val()))return $(a).data("alias")}))]);try{if($dashMain.vars.cmbCamposSelectedValues.map(e=>{const a=$(`#frmConfigSearch .sectionInsertInputs .inputField[data-alias="${e}"]`);a.length>0&&(null==a.data("uiSlider")?Cookies.set(e,a.val(),{path:""}):Cookies.set(e,a.data("uiSlider").options.values,{path:""}))}),s.prop("disabled",!0),s.find("optgroup").remove(),s.find("option").remove(),o.length>0){i.LoadingOverlay("show"),s.append('<option disabled selected value><i class="fa fa-refresh fa-spin fa-3x fa-fw"></i> Actualizando, favor de esperar...</option>');const e=await $.genericAjaxPromise({ajax:{type:"POST",url:`${siteUrl}Catalogs/ajaxFields`,data:{csrf_QUERY:csrf.hash,model:{idDb:o}},headers:{}},showloadingOverlay:!1}).catch(function(e){return e});if(!$ajaxResponse.check(e))throw e;s.find("optgroup").remove(),s.find("option").remove();const a=groupBy("idCaDataBase"),t=a(e.data);if(Object.keys(t).length>1){const a=groupBy("alias"),t=a(e.data);$.each(t,function(e,a){const t=Guid.generate(),n=a.sort((e,a)=>e.database>a.database?1:a.database>e.database?-1:0).map(e=>`<span><text class='text-info'><small>${e.grupo.toUpperCase()}</small></text> [ ${e.database.toUpperCase()} ]</span>`).join(" - "),o=`<option value="${t}" data-inputfield='${t}' data-alias='${e}'>${e.toUpperCase()}</option>`,i=s.find('optgroup[label="'+n+'"]');i.length>0?s.append(i.append(o)):s.append(`<optgroup data-label="${n}" label="${n}">${o}</optgroup>`)})}else e.data.forEach(e=>{const a=Guid.generate();s.append(`<option value="${a}" data-inputfield='${a}' data-alias='${e.alias}'>${e.alias.toUpperCase()}</option>`)})}$dashMain.vars.cmbBdPropagationCount--,$dashMain.vars.cmbBdPropagationCount<=0&&($("#bd").val().length>0||!a?(s.select2("destroy"),s.select2({width:"100%",templateSelection:$dashMain.utils.Select2TemplateSelection,escapeMarkup:function(e){return e}}),n.html(""),s.val(s.find("option").map((e,a)=>{if($dashMain.vars.cmbCamposSelectedValues.includes($(a).data("alias")))return $(a).val()})).trigger("change"),s.prop("disabled",!1)):$dashMain.actions.resetNoDataSelect(),i.LoadingOverlay("hide",!0),$dashMain.actions.refreshSectionInsertInputs(),n.LoadingOverlay("hide"),$dashMain.vars.cmbBdPropagationCount=0,$dashMain.vars.cmbCamposSelectedValues=null)}catch(e){return $exception._throw(e,t),s.find("option").remove(),s.setError("ERROR al actualizar"),n.LoadingOverlay("hide"),!1}}},change:{handleAll:e=>{const a=e.params.args.data.id;"9999"==a?$(e.currentTarget).val(null).trigger("change"):$(e.currentTarget).val($(e.currentTarget).val().filter(e=>"9999"!=e))},cmbBdChange:async e=>{const a=$(e.currentTarget).val();$dashMain.actions.populate.findFor(a,!0)},cmbCampoChangeSelect:e=>{const a=$(window).width()<768?"w-100":"w-50",t=(e.params.args.data.element.dataset.model,e.params.args.data.text.toUpperCase()),n=e.params.args.data.element.dataset.inputfield,s=e.params.args.data.element.dataset.alias,o=e.params.args.data.element.dataset.value?e.params.args.data.element.dataset.value:"",i=$("#frmConfigSearch .sectionInsertInputs"),r=!!e.params.args.data.element.parentElement&&("optgroup"==e.params.args.data.element.parentElement.tagName.toLowerCase()&&e.params.args.data.element.parentElement.label),l=`<div class="${a} p-2 section_${n}">\n\t\t\t\t\t\t\t\t<label for="${n}" class='requiredMark mb-0'>${(r?`<strong>${r}</strong>  - `:"")+("edad"!=t.toLowerCase()?t:'RANGO DE EDAD <small class="font-weight-bold">[ ENTRE <span class="h5 rangeInit">1</span> Y <span class="h5 rangeEnd">100</span> AÑO(S) ]</small>')}</label>\n\t\t\t\t\t\t\t\t${"edad"!=s.toLowerCase()?`<input type="text" class="form-control inputField required" name='${n}' minlength="2" data-inputfield='${n}' data-alias='${s}' value='${o}' required>`:`<div id="slider-range" class='sliderRange mt-1 inputField required' data-inputfield='${n}' data-alias='${s}' value='${o}' required></div>`}\n\t\t\t\t\t\t\t\t</div>`;if(i.append(l),"edad"==s.toLowerCase()){const e={range:!0,min:1,max:100,values:[1,100],slide:function(e,a){const t=$(e.target),n=t.find(".ui-slider-handle");t.val(a.values.toString()),$(n[0]).html(a.values[0]),$(n[1]).html(a.values[1]),$(".rangeInit").html(a.values[0]),$(".rangeEnd").html(a.values[1])}};if(o){const a=JSON.parse(o);e.values=[a[0],a[1]]}$("#slider-range").slider(e);const a=$("#slider-range .ui-slider-handle");$(a[0]).html(e.values[0]),$(a[1]).html(e.values[1])}$(".searchBtn").attr("disabled",0==i.find(".inputField.required").length),0==i.find(".inputField").length?$("#frmConfigSearch .card").addClass("d-none"):$("#frmConfigSearch .card").removeClass("d-none"),$(document.querySelectorAll('input[data-alias="domicilio"]')).attr("placeholder","especifique sólo la calle...")},cmbCampoChangeUnSelect:e=>{const a=e.params.args.data.element.dataset.inputfield,t=$("#frmConfigSearch .sectionInsertInputs"),n=t.find(`.section_${a}`);n.remove(),$(".searchBtn").attr("disabled",0==t.find(".inputField.required").length),0==t.find(".inputField").length?$("#frmConfigSearch .card").addClass("d-none"):$("#frmConfigSearch .card").removeClass("d-none")}},click:{clearSearch:async()=>{const e=await Swal.fire({title:"Limpieza",text:"Confirma limpiar el resultado de la búsqueda",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",backdrop:!0,allowOutsideClick:!1});if(e.dismiss)return!1;const a=$("html,body");a.animate({scrollTop:0,scrollLeft:0},300),setTimeout(()=>{$dashMain.actions.clearSearchSection()},300)},cancelSearch:async()=>{const e=await Swal.fire({title:"Detener",text:"Confirma detener el proceso de búsqueda",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar",cancelButtonText:"Cancelar",backdrop:!0,allowOutsideClick:!1});if(e.dismiss)return!1;$(".cancelSearch").prop("disabled",!0),$(".cancelSearch").html('<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> Deteniendo búsqueda'),$dashMain.vars.stopSearch=!0,$.xhrPool.abortAll()}},fill:{search:async function(e){e.preventDefault(),$(".stopProcAlert").addClass("d-none");const a=$("#searchViewForm"),t=$(this),n=$(".tabs"),s=$(".notifyArea");try{s.closeAlert({alertType:"alert-danger"});const e=t.valid(),o=a.valid();if(!e||!o)throw new Error("Formulario incompleto");const i=$("#frmConfigSearch .sectionInsertInputs"),r=i.find(".inputField.required"),l={entidad:$("#entidad").val(),db:$("#bd").val(),campos:r.map((e,a)=>$(a).data("alias")),valores:r.map((e,a)=>$(a).val())};if((l.db.includes("9999")||l.entidad.includes("9999"))&&l.campos.length<2){const e=await Swal.fire({title:"Búsqueda",text:"Para disminuir los tiempos de búsqueda se recomienda seleccionar al menos dos campos",icon:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Continuar",cancelButtonText:"Cancelar búsqueda",backdrop:!0,allowOutsideClick:!1});if(e.dismiss)return!1}l.db.includes("9999")&&(l.db=$("#bd").find("option").map((e,a)=>"9999"!=$(a).val()?$(a).val():null),l.db=Object.values(l.db).splice(0,l.db.length)),l.entidad.includes("9999")&&(l.entidad=$("#entidad").find("option").map((e,a)=>"9999"!=$(a).val()?$(a).val():null),l.entidad=Object.values(l.entidad).splice(0,l.entidad.length)),"Notification"in window&&"granted"!==Notification.permission&&Notification.requestPermission(function(e){}),$dashMain.actions.clearSearchSection(),window.clearInterval($slumber.session.vars._idleSecondsTimer),$(".searchBtn").prop("disabled",!0),$(".searchBtn").html('<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> BUSCANDO'),$(".cancelSearch").removeClass("d-none"),$(".clearSearch").addClass("d-none"),n.LoadingOverlay("show"),$dashMain.vars.stopSearch=!1,$dashMain.vars.tables.results=[];for(let e=0;e<l.db.length;e++)$dashMain.utils.createCardSection(l.db[e]);const d=$("html,body"),c=$("#searchResult"),p=$(".searchResult");p.removeClass("d-none"),c.css("min-height",$dashMain.vars.screenHeightInit),setTimeout(()=>{d.animate({scrollTop:c.offset().top,scrollLeft:0},300),n.LoadingOverlay("hide")},5);const u=performance.now();let h=0;for(let e=0;e<l.db.length;e++){const a=l.db[e],t=$dashMain.utils.get.sectionParts(a),n=$(`.card.${t.databasenameWithOutSpacesgroup}`),s=$(`.card.${t.databasenameWithOutSpacesgroup} #collapse_${t.databasenameWithOutSpacesgroup} .card-body`);$__notifySection=n.find(".notifySection"),$__buttonCollapse=n.find("button.btn"),$__progress=$__notifySection.find(".progress .progress-bar"),$__loaderSearch=$__notifySection.find(".loaderSearch"),$__progress.attr("aria-valuemin",l.entidad.length).css("width","0%"),$__loaderSearch.removeClass("d-none").addClass("show");let o=null,i=!1,r=0;for(let e=0;e<l.entidad.length;e++){if($dashMain.vars.stopSearch)return $dashMain.utils.stopSearch(),!1;const t=l.entidad[e],n={db:a,entidad:[t],campos:Object.values(l.campos).splice(0,l.campos.length),valores:Object.values(l.valores).splice(0,l.valores.length)};try{const e=await $.genericAjaxPromise({ajax:{type:"POST",url:`${siteUrl}Dashboard/ajaxSearch`,data:{csrf_QUERY:csrf.hash,model:n},headers:{}},showloadingOverlay:!1});if(!e.data)throw i=!0,"Se requere que precise más los criterios para su búsqueda.";-1!=e.data.observaciones.indexOf("No fué posible filtrar por ENTIDAD")?i=!0:e.data.entidad=$(`#entidad option[value='${t}']`).text(),e.model=n,o=e,r+=e.data?e.data.items.length:0}catch(e){o={status:!1,message:e,model:n}}if($__progress.attr("aria-valuenow",e).css("width",`${100*e/l.entidad.length}%`),$dashMain.utils.genericFill(o),i)break}$__progress.attr("aria-valuenow",100).css("width","100%"),$__loaderSearch.addClass("d-none");let d="";switch(r){case 0:s.remove(),$__parent=$__buttonCollapse.parent(),$__text=$__buttonCollapse.text(),$__buttonCollapse.remove(),$__parent.prepend(`<h4 class='pl-2' style='width: 30%;'>${$__text}</h4>`),d="No se encontraron registros";break;case 1:d='Se encontró <strong class="h3">1</strong> registro';default:d=`Se encontrararon <strong class='h3'>${r}</strong> registros`}0==$__notifySection.find(".text-danger").length&&($__notifySection.append(`<h5 class='${0==r?"text-danger":""}' style='position: absolute;top: 26px;right: 5px;max-width: 25%;'><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ${d} </h5>`),r>0&&$__notifySection.append(`<div class='' style='position: absolute;bottom: 2px;right: 5px;'>\n\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-outline-secondary btn-sm btnPDFDB" style='padding: 0.1rem .2rem!important;' title='Generar PDF' data-id='${t.databasenameWithOutSpacesgroup}' onclick="$dashMain.utils.btnPDFDB(event); return null;">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-file-pdf-o fa-2x" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>`)),h+=r}const m=performance.now(),f=moment.duration(m-u,"milliseconds");$(".searchBtn").html('<i class="fa fa-search" aria-hidden="true"></i> BUSCAR'),$(".searchBtn").prop("disabled",!1),$(".clearSearch").removeClass("d-none"),$(".cancelSearch").addClass("d-none"),$slumber.session.init(600);const b=`<div class="jumbotron">\n                        <h1 class="display-4">Sumario de búsqueda</h1>\n                        <p class="lead"> \n                            Se buscaron en <span class='h3 d-inline px-1'> ${l.db.length} </span> fuente(s) de datos, se encontraron <span class='h3 d-inline px-1'> ${h} </span> registro(s).<br/>\n                            El tiempo total de la búsqueda fue de <span class='h3 d-inline px-1'> [ ${f._data.hours} horas, ${f._data.minutes} minutos y ${f._data.seconds} segundos ] </span>.\n                        </p>\n                        <!--<div class='text-right'>\n                            <button type="button" class="btn btn-outline-dark"><i class="fa fa-file-pdf-o fa-2x" aria-hidden="true"></i> Generar pdf global</button>\n                        </div>-->\n                    </div>`;$("#searchResult").append(b);try{const e=new Notification("Búsqueda terminada",{icon:`${baseUrl}assets/Images/search128px.png`,body:`Se buscaron en ${l.db.length} fuente(s) de datos, se encontraron ${h} registro(s).`});e.onclick=function(){parent.focus(),window.focus(),this.close()}}catch(e){}}catch(e){$exception._throw(e,s)}}},resetNoDataSelect:()=>{const e=$(".searchBtn"),a=$("#campo"),t=$("#frmConfigSearch .sectionInsertInputs"),n=$("#frmConfigSearch .card");e.attr("disabled",!0),a.prop("disabled",!0),a.find("optgroup").remove(),a.find("option").remove(),t.html(""),t.LoadingOverlay("hide"),n.addClass("d-none")},clearSearchSection:()=>{const e=$(".searchResult"),a=e.find("#accordionSearchResult");e.addClass("d-none"),a.html(""),e.find(".jumbotron").remove()},refreshSectionInsertInputs:()=>{const e=$("#campo"),a={params:{args:{data:{text:"",element:{dataset:{inputfield:"",alias:""}}}}}};e.find("option:selected").map((e,t)=>{a.params.args.data.text=$(t).text(),a.params.args.data.element.dataset.inputfield=$(t).data("inputfield"),a.params.args.data.element.dataset.alias=$(t).data("alias"),a.params.args.data.element.dataset.value=Cookies.get($(t).data("alias"),{path:""}),Cookies.remove($(t).data("alias"),{path:""}),$dashMain.actions.change.cmbCampoChangeSelect(a)})}},utils:{ajaxSetup:()=>{$.xhrPool=[],$.xhrPool.abortAll=function(){$(this).each(function(e,a){a.abort(),$.xhrPool.splice(e,1)})},$.ajaxSetup({beforeSend:function(e){$.xhrPool.push(e)},complete:function(e){var a=$.xhrPool.indexOf(e);a>-1&&$.xhrPool.splice(a,1)}})},Select2TemplateSelection:e=>`<span>\n                <text class='text-info'>\n                    <small>\n                        ${"optgroup"==$(e.element).parent().get(0).tagName.toLowerCase()?$(e.element).parent().get(0).label+" ":""}\n                    </small>\n                </text>\n                [ ${e.text} ]\n            </span>`,genericCMB:async e=>{const a={item:null,pairNames:{key:null,value:null},notifyDom:null,genericAjaxPromiseOptions:null,callback:null};options=$.extend(a,e);const t=e.notifyDom,n=e.item;n.prop("disabled",!0),n.find("option").remove(),n.append('<option disabled selected value><i class="fa fa-refresh fa-spin fa-3x fa-fw"></i> Actualizando, favor de esperar...</option>');try{const a=await $.genericAjaxPromise(e.genericAjaxPromiseOptions).catch(function(e){return e});if(!$ajaxResponse.check(a))throw a;return n.find("option").remove(),"grupo"in a.data[0]?new Promise(t=>{const s=groupBy("grupo")(a.data);let o=Object.keys(s).length;$.each(s,(s,i)=>{let r=i.length,l=`<optgroup data-label="${s}" label="${s}">`;i.forEach(a=>{const t=`<option value="${a[e.pairNames.key]}">${a[e.pairNames.value]}</option>`;l+=t,r--,0==r&&(l+="</optgroup>",n.append(l))}),o--,0==o&&(n.prop("disabled",!1),"function"==typeof e.callback&&e.callback(),t(a.data))})}):new Promise(t=>{let s=a.data.length;a.data.forEach(o=>{const i=new Option(o[e.pairNames.value],o[e.pairNames.key]);n.append(i),s--,0==s&&(n.prop("disabled",!1),"function"==typeof e.callback&&e.callback(),t(a.data))})})}catch(e){return $exception._throw(e,t),n.find("option").remove(),n.setError("ERROR al actualizar"),new Promise(e=>e(!1))}},stopSearch:()=>{$(".loaderSearch.show").addClass("d-none"),$(".cancelSearch").addClass("d-none"),$(".cancelSearch").prop("disabled",!1),$(".cancelSearch").html("Detener búsqueda"),$(".clearSearch").removeClass("d-none"),$(".searchBtn").html('<i class="fa fa-search" aria-hidden="true"></i> BUSCAR'),$(".searchBtn").prop("disabled",!1),$(".stopProcAlert").removeClass("d-none")},get:{sectionParts:e=>{const a=$(`#bd option[value="${e}"]`).text(),t=$(`#bd option[value="${e}"]`).closest("optgroup").attr("label"),n=`${a}`.replace(/[^a-zA-Z0-9]/g,"_"),s=`${t}`.replace(/[^a-zA-Z0-9]/g,"_"),o=`${s}_${n}`;return{databasename:a,group:t,databasenameWithOutSpaces:n,groupWithOutSpaces:s,databasenameWithOutSpacesgroup:o}}},createCardSection:e=>{const a=$(".searchResult"),t=a.find("#accordionSearchResult"),n=$dashMain.utils.get.sectionParts(e),s=n.databasename,o=n.group,i=n.databasenameWithOutSpacesgroup,r=`<div class="card ${i}">\n                    <div class="card-header" id="${i}">\n                        <h3 class="mb-0">\n                            <div class='d-flex justify-content-between'>\n                                <button style='width: 30%;' class="btn btn-link text-left" data-databaseGroupName='${n.databasenameWithOutSpacesgroup}' data-toggle="collapse" data-target="#collapse_${i}" aria-expanded="true" aria-controls="collapse_${i}"><small>${o}</small> [ ${s} ]</button>\n                                <div class='notifySection mt-2 text-right' style='width: 100%;height: 67px;'>\n                                    <div class="progress" style="height: 20px;position: absolute;width: 20%;top: 5px;right: 5px;">\n                                        <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="0"></div>\n                                    </div>\n                                    <i class="loaderSearch d-none fa fa-cog fa-spin fa-fw" style="position: absolute;bottom: 5px;right: 5px;z-index:9999;"></i>\n                                </div>\n                            </div>\n                        </h3>\n                    </div>\n                    <div id="collapse_${i}" class="collapse collapsed" aria-labelledby="${i}" data-parent="#accordionSearchResult">\n                        <div class="card-body"></div>\n                    </div>\n                </div>`;t.append(r)},genericFill:e=>{const a=$(".searchResult"),t=(a.find("#accordionSearchResult"),$dashMain.utils.get.sectionParts(e.model.db)),n=t.databasename,s=t.group,o=t.databasenameWithOutSpacesgroup,i=$(`.card.${o} .card-header#${o} .notifySection`),r=$(`.card.${o} #collapse_${o} .card-body`);if(e.status){const a=e.data.items,t=0==a.length?null:Object.keys(a[0]),i=0==a.length?null:t.map(e=>`<th>${e.toUpperCase()}</th>`).join("")+"<th>ENTIDAD</th>";$__searchModel=$dashMain.vars.tables.results.find(e=>e.id==o),$__searchModel?($dashMain.utils.pupulateTable(a,$__searchModel.tblObj,e.data.entidad),$dashMain.utils.showObservations(r,e.data)):($__template=`<div class='pb-5'>\n                        <table id="tbl_${o}" class="display nowrap table-striped d-none" style="width:100%">\n                            <thead><tr class="text-center">${i}</tr></thead>\n                            <tbody></tbody>\n                        </table>\n                    </div>`,r.append($__template),setTimeout(()=>{const t=$(`#tbl_${o}`).DataTable({dom:"Bfrtip",buttons:[{extend:"pdfHtml5",title:`${s} [ ${n} ]`,messageTop:"mensaje top",filename:`${o}_${moment().format("L").replace(/\//g,"-")}`,orientation:"landscape",pageSize:"A0",customize:function(e){let a="";switch(e.content[2].table.body.length-1){case 0:a+="No se encontraron registros";break;case 1:a+="Se encontró 1 registro";break;default:a+=`Se encontraron ${e.content[2].table.body.length-1} registros`}e.content[1].text=a,e.styles.title={alignment:"left",fontSize:30},e.content[2].table.widths=Array(e.content[2].table.body[0].length+1).join("*").split("")}}],columnDefs:[{targets:"_all",className:"px-1"}],initComplete:function(t){$(t.nTable).removeClass("d-none"),$(t.nTableWrapper).find(".dt-buttons").addClass("d-none"),setTimeout(()=>{$__searchModel=$dashMain.vars.tables.results.find(e=>e.id==o),$dashMain.utils.pupulateTable(a,$__searchModel.tblObj,e.data.entidad),$dashMain.utils.showObservations(r,e.data)},500)}});$dashMain.vars.tables.results.push({id:o,tblObj:t})},500))}else"Se requere que precise más los criterios para su búsqueda."==e.message&&i.html(`<h4 class='text-danger'><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ${e.message}</h4>`)},pupulateTable:(e,a,t="")=>{Rx.Observable.fromArray(e).subscribe(async e=>{const n=await new Promise(a=>{const n=[],s=new Map(Object.entries(e));let o=s.size;s.forEach((e,s)=>{n.push(e),o--,0==o&&(n.push(t),a(n))})});a.row.add(n).draw(!1),setTimeout(()=>{a.responsive.recalc(),a.responsive.rebuild()},5)})},showObservations:(e,a)=>{if(!a.hasOwnProperty("observaciones"))return!1;const t=a.observaciones;if(0==t.length)return!1;const n=`<div class='note'>\n\t\t\t\t<h4 class='text-danger'>Observaciones</h4>\n\t\t\t\t<ul class='text-dark'>\n\t\t\t\t\t${t.map(e=>`<li>${e}</li>`).join()}\n\t\t\t\t</ul>\n\t\t\t</div>`;e.prepend(n)},btnPDFDB:e=>{e.preventDefault();const a=$(e.currentTarget).data("id");$(`#tbl_${a}_wrapper .dt-buttons button.dt-button.buttons-pdf`).click(),Swal.fire({position:"top-end",icon:"info",title:"Generando formato PDF",footer:"Favor de esperar",showConfirmButton:!1,timer:5e3})}}};$(document).ready(()=>{$dashMain.fncs.init()});
